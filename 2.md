ğŸš€ ä»»åŠ¡ä¸€ï¼š[åç«¯] è®©åˆ—è¡¨æ˜¾ç¤ºâ€œåç§°â€è€Œä¸æ˜¯â€œIDâ€
ç›®æ ‡ï¼š åœ¨æ–‡ç« åˆ—è¡¨æ˜¾ç¤ºâ€œåˆ†ç±»åç§°â€ï¼Œåœ¨è¯„è®ºåˆ—è¡¨æ˜¾ç¤ºâ€œæ–‡ç« æ ‡é¢˜â€ã€‚

1. ä¿®æ”¹ Domain å®ä½“ç±» (æ·»åŠ æ–°å­—æ®µ)
æ–‡ä»¶ 1ï¼š api/RuoYi-Vue/ruoyi-admin/src/main/java/com/ruoyi/blog/domain/BlogArticle.java

æ“ä½œï¼š æ·»åŠ  categoryName å­—æ®µã€‚

Java

// ... (å¯¼å…¥çš„åŒ…)

public class BlogArticle extends BaseEntity
{
    // ... (æ‰€æœ‰å·²ç”Ÿæˆçš„å­—æ®µ) ...

    /** åˆ†ç±»åç§° (éæ•°æ®åº“å­—æ®µ) */
    private String categoryName;

    // --- (å·²ç”Ÿæˆçš„ getter/setter) ---

    // vvvvvv æ‰‹åŠ¨æ·»åŠ  vvvvvv
    public String getCategoryName() 
    {
        return categoryName;
    }

    public void setCategoryName(String categoryName) 
    {
        this.categoryName = categoryName;
    }
    // ^^^^^^ æ‰‹åŠ¨æ·»åŠ  ^^^^^^
}
æ–‡ä»¶ 2ï¼š api/RuoYi-Vue/ruoyi-admin/src/main/java/com/ruoyi/blog/domain/BlogComment.java

æ“ä½œï¼š æ·»åŠ  articleTitle å­—æ®µã€‚

Java

// ... (å¯¼å…¥çš„åŒ…)

public class BlogComment extends BaseEntity
{
    // ... (æ‰€æœ‰å·²ç”Ÿæˆçš„å­—æ®µ) ...

    /** æ–‡ç« æ ‡é¢˜ (éæ•°æ®åº“å­—æ®µ) */
    private String articleTitle;

    // --- (å·²ç”Ÿæˆçš„ getter/setter) ---

    // vvvvvv æ‰‹åŠ¨æ·»åŠ  vvvvvv
    public String getArticleTitle() 
    {
        return articleTitle;
    }

    public void setArticleTitle(String articleTitle) 
    {
        this.articleTitle = articleTitle;
    }
    // ^^^^^^ æ‰‹åŠ¨æ·»åŠ  ^^^^^^
}
2. ä¿®æ”¹ Mapper XML (ä¿®æ”¹ SQL æŸ¥è¯¢)
æ–‡ä»¶ 1ï¼š api/RuoYi-Vue/ruoyi-admin/src/main/resources/mapper/blog/BlogArticleMapper.xml

æ“ä½œ 1ï¼š æ‰¾åˆ° <sql id="selectBlogArticleVo"> æ ‡ç­¾ã€‚

ä¿®æ”¹ï¼š åœ¨ from è¯­å¥åæ·»åŠ  LEFT JOINï¼Œå¹¶ä¸ºè¡¨è®¾ç½®åˆ«å a å’Œ cã€‚

ä¿®æ”¹å‰ (ç±»ä¼¼)ï¼š

XML

<sql id="selectBlogArticleVo">
    select article_id, user_id, category_id, ... from blog_article
</sql>
ä¿®æ”¹åï¼š

XML

<sql id="selectBlogArticleVo">
    select a.article_id, a.user_id, a.category_id, a.title, a.summary, a.content, a.cover_image_url, a.status, a.allow_comment, a.view_count, a.del_flag, a.create_by, a.create_time, a.update_by, a.update_time, a.remark,
           c.name as categoryName
    from blog_article a
    left join blog_category c on a.category_id = c.category_id
</sql>
æ“ä½œ 2ï¼š æ‰¾åˆ° <select id="selectBlogArticleList" ...> æ ‡ç­¾ã€‚

ä¿®æ”¹ï¼š åœ¨å…¶å†…éƒ¨çš„ <where> æ ‡ç­¾ä¸­ï¼Œä¸ºæ‰€æœ‰æŸ¥è¯¢å­—æ®µæ·»åŠ åˆ«å a.ã€‚

ä¿®æ”¹å‰ (ç±»ä¼¼)ï¼š

XML

<where>
    <if test="title != null  and title != ''"> and title like concat('%', #{title}, '%')</if>
    <if test="categoryId != null "> and category_id = #{categoryId}</if>
    ...
</where>
ä¿®æ”¹åï¼š

XML

<where>
    <if test="title != null  and title != ''"> and a.title like concat('%', #{title}, '%')</if>
    <if test="categoryId != null "> and a.category_id = #{categoryId}</if>
    <if test="status != null  and status != ''"> and a.status = #{status}</if>
    ...
</where>
æ–‡ä»¶ 2ï¼š api/RuoYi-Vue/ruoyi-admin/src/main/resources/mapper/blog/BlogCommentMapper.xml

æ“ä½œ 1ï¼š æ‰¾åˆ° <sql id="selectBlogCommentVo">ï¼Œæ·»åŠ  LEFT JOINã€‚

ä¿®æ”¹åï¼š

XML

<sql id="selectBlogCommentVo">
    select c.comment_id, c.article_id, c.user_id, c.nickname, c.email, c.content, c.parent_id, c.status, c.del_flag, c.create_by, c.create_time, c.update_by, c.update_time,
           a.title as articleTitle
    from blog_comment c
    left join blog_article a on c.article_id = a.article_id
</sql>
æ“ä½œ 2ï¼š æ‰¾åˆ° <select id="selectBlogCommentList" ...>ï¼Œä¸ºå…¶ <where> æ ‡ç­¾ä¸­çš„å­—æ®µæ·»åŠ åˆ«å c.ã€‚

ä¿®æ”¹åï¼š

XML

<where>
    <if test="articleId != null "> and c.article_id = #{articleId}</if>
    <if test="status != null  and status != ''"> and c.status = #{status}</if>
    ...
</where>
ğŸš€ ä»»åŠ¡äºŒï¼š[åç«¯] å®ç°â€œæ–‡ç« -æ ‡ç­¾â€å¤šå¯¹å¤šæ ¸å¿ƒé€»è¾‘
ç›®æ ‡ï¼š åœ¨æ–°å¢æˆ–ä¿®æ”¹æ–‡ç« æ—¶ï¼Œå°†æ–‡ç« å’Œæ ‡ç­¾çš„å…³ç³»ä¿å­˜åˆ° blog_article_tag è¡¨ä¸­ã€‚

1. åˆ›å»ºæ–°æ–‡ä»¶ BlogArticleTag.java
æ“ä½œï¼š åœ¨ com/ruoyi/blog/domain/ ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ã€‚

è·¯å¾„ï¼š api/RuoYi-Vue/ruoyi-admin/src/main/java/com/ruoyi/blog/domain/BlogArticleTag.java

Java

package com.ruoyi.blog.domain;

/**
 * æ–‡ç« æ ‡ç­¾å…³è” blog_article_tag
 * (æ‰‹åŠ¨åˆ›å»º)
 */
public class BlogArticleTag
{
    private Long articleId;
    private Long tagId;

    public BlogArticleTag() {}

    public BlogArticleTag(Long articleId, Long tagId) {
        this.articleId = articleId;
        this.tagId = tagId;
    }

    // --- getter å’Œ setter ---
    public Long getArticleId() { return articleId; }
    public void setArticleId(Long articleId) { this.articleId = articleId; }
    public Long getTagId() { return tagId; }
    public void setTagId(Long tagId) { this.tagId = tagId; }
}
2. ä¿®æ”¹ BlogArticle.java (å†æ¬¡)
æ–‡ä»¶ï¼š api/RuoYi-Vue/ruoyi-admin/src/main/java/com/ruoyi/blog/domain/BlogArticle.java

æ“ä½œï¼š æ·»åŠ  tagIds å­—æ®µï¼Œç”¨äºæ¥æ”¶å‰ç«¯ä¼ æ¥çš„æ ‡ç­¾æ•°ç»„ã€‚

Java

import java.util.List; // vvvvvv ç¡®ä¿å¯¼å…¥ vvvvvv

public class BlogArticle extends BaseEntity
{
    // ... (å·²æœ‰å­—æ®µ) ...
    private String categoryName; // (ä»»åŠ¡ä¸€æ·»åŠ çš„)
    
    /** æ ‡ç­¾IDæ•°ç»„ (éæ•°æ®åº“å­—æ®µ) */
    private List<Long> tagIds; // vvvvvv æ‰‹åŠ¨æ·»åŠ  vvvvvv

    // ... (å·²æœ‰ getter/setter) ...
    
    // vvvvvv æ‰‹åŠ¨æ·»åŠ  vvvvvv
    public List<Long> getTagIds() {
        return tagIds;
    }
    public void setTagIds(List<Long> tagIds) {
        this.tagIds = tagIds;
    }
    // ^^^^^^ æ‰‹åŠ¨æ·»åŠ  ^^^^^^
}
3. ä¿®æ”¹ BlogArticleMapper.java (æ¥å£)
æ–‡ä»¶ï¼š api/RuoYi-Vue/ruoyi-admin/src/main/java/com/ruoyi/blog/mapper/BlogArticleMapper.java

æ“ä½œï¼š æ·»åŠ  2 ä¸ªæ–°æ–¹æ³•ç­¾åã€‚

Java

import java.util.List; // vvvvvv ç¡®ä¿å¯¼å…¥ vvvvvv
import com.ruoyi.blog.domain.BlogArticleTag; // vvvvvv ç¡®ä¿å¯¼å…¥ vvvvvv

public interface BlogArticleMapper 
{
    // ... (å·²æœ‰æ–¹æ³•) ...

    // vvvvvv æ‰‹åŠ¨æ·»åŠ  vvvvvv
    /**
     * æ‰¹é‡æ–°å¢æ–‡ç« æ ‡ç­¾å…³è”
     */
    public int batchInsertArticleTag(List<BlogArticleTag> blogArticleTagList);

    /**
     * é€šè¿‡æ–‡ç« IDåˆ é™¤æ–‡ç« æ ‡ç­¾å…³è”
     */
    public int deleteArticleTagByArticleId(Long articleId);
    // ^^^^^^ æ‰‹åŠ¨æ·»åŠ  ^^^^^^
}
4. ä¿®æ”¹ BlogArticleMapper.xml (å†æ¬¡)
æ–‡ä»¶ï¼š api/RuoYi-Vue/ruoyi-admin/src/main/resources/mapper/blog/BlogArticleMapper.xml

æ“ä½œï¼š åœ¨ </mapper> æ ‡ç­¾å‰ï¼Œæ·»åŠ  2 ä¸ªæ–°çš„ SQL å—ã€‚

XML

    <insert id="batchInsertArticleTag">
        insert into blog_article_tag(article_id, tag_id) values
        <foreach item="item" index="index" collection="list" separator=",">
            (#{item.articleId}, #{item.tagId})
        </foreach>
    </insert>

    <delete id="deleteArticleTagByArticleId">
        delete from blog_article_tag where article_id = #{articleId}
    </delete>
    </mapper>
5. ä¿®æ”¹ BlogArticleServiceImpl.java (æ ¸å¿ƒé€»è¾‘)
æ–‡ä»¶ï¼š api/RuoYi-Vue/ruoyi-admin/src/main/java/com/ruoyi/blog/service/impl/BlogArticleServiceImpl.java

æ“ä½œï¼š ä¿®æ”¹ insert å’Œ update æ–¹æ³•ï¼Œå¹¶æ·»åŠ äº‹åŠ¡ã€‚

Java

package com.ruoyi.blog.service.impl;

// vvvvvv æ‰‹åŠ¨æ·»åŠ å¯¼å…¥ vvvvvv
import java.util.ArrayList;
import java.util.List;
import com.ruoyi.blog.domain.BlogArticleTag;
import org.springframework.transaction.annotation.Transactional;
// ^^^^^^ æ‰‹åŠ¨æ·»åŠ å¯¼å…¥ ^^^^^^

// ... (å…¶ä»–å¯¼å…¥) ...

@Service
public class BlogArticleServiceImpl implements IBlogArticleService 
{
    @Autowired
    private BlogArticleMapper blogArticleMapper;

    // ... (å·²æœ‰çš„ select, delete æ–¹æ³•) ...

    /**
     * æ–°å¢åšå®¢æ–‡ç« 
     */
    @Override
    @Transactional // vvvvvv æ‰‹åŠ¨æ·»åŠ  vvvvvv
    public int insertBlogArticle(BlogArticle blogArticle)
    {
        blogArticle.setCreateTime(DateUtils.getNowDate());
        // 1. æ’å…¥æ–‡ç« ä¸»è¡¨
        // (ç¡®ä¿ BlogArticleMapper.xml çš„ <insert> æ ‡ç­¾æœ‰ useGeneratedKeys="true" keyProperty="articleId")
        int rows = blogArticleMapper.insertBlogArticle(blogArticle);
        
        // 2. æ’å…¥æ–‡ç« æ ‡ç­¾å…³è”
        // vvvvvv æ‰‹åŠ¨æ·»åŠ  vvvvvv
        insertArticleTag(blogArticle); 
        // ^^^^^^ æ‰‹åŠ¨æ·»åŠ  ^^^^^^
        return rows;
    }

    /**
     * ä¿®æ”¹åšå®¢æ–‡ç« 
     */
    @Override
    @Transactional // vvvvvv æ‰‹åŠ¨æ·»åŠ  vvvvvv
    public int updateBlogArticle(BlogArticle blogArticle)
    {
        blogArticle.setUpdateTime(DateUtils.getNowDate());
        // 1. æ›´æ–°æ–‡ç« ä¸»è¡¨
        int rows = blogArticleMapper.updateBlogArticle(blogArticle);
        
        // 2. åˆ é™¤æ—§çš„æ ‡ç­¾å…³è”
        // vvvvvv æ‰‹åŠ¨æ·»åŠ  vvvvvv
        blogArticleMapper.deleteArticleTagByArticleId(blogArticle.getArticleId());
        
        // 3. æ’å…¥æ–°çš„æ ‡ç­¾å…³è”
        insertArticleTag(blogArticle);
        // ^^^^^^ æ‰‹åŠ¨æ·»åŠ  ^^^^^^
        return rows;
    }

    // vvvvvv æ‰‹åŠ¨æ·»åŠ  vvvvvv
    /**
     * æ–°å¢æ–‡ç« æ ‡ç­¾å…³è”ä¿¡æ¯ (è¾…åŠ©æ–¹æ³•)
     */
    public void insertArticleTag(BlogArticle blogArticle)
    {
        List<Long> tagIds = blogArticle.getTagIds();
        if (tagIds != null && !tagIds.isEmpty())
        {
            List<BlogArticleTag> list = new ArrayList<>();
            for (Long tagId : tagIds)
            {
                list.add(new BlogArticleTag(blogArticle.getArticleId(), tagId));
            }
            // æ‰¹é‡æ’å…¥
            blogArticleMapper.batchInsertArticleTag(list);
        }
    }
    // ^^^^^^ æ‰‹åŠ¨æ·»åŠ  ^^^^^^
}
ğŸš€ ä»»åŠ¡ä¸‰ï¼š[å‰ç«¯] ä¿®æ”¹ Vue é¡µé¢ä»¥æ”¯æŒæ–°åŠŸèƒ½
ç›®æ ‡ï¼š

è®©åˆ—è¡¨æ˜¾ç¤ºâ€œåç§°â€è€Œä¸æ˜¯â€œIDâ€ã€‚

åœ¨â€œæ·»åŠ /ä¿®æ”¹â€æ–‡ç« æ—¶ï¼ŒåŠ å…¥â€œåˆ†ç±»â€å’Œâ€œå¤šé€‰æ ‡ç­¾â€çš„åŠŸèƒ½ã€‚

1. ä¿®æ”¹æ–‡ç« åˆ—è¡¨ (æ˜¾ç¤ºåˆ†ç±»åç§°)
æ–‡ä»¶ï¼š admin/RuoYi-Vue3/src/views/blog/article/index.vue

æ“ä½œï¼š æ‰¾åˆ° <el-table-column label="åˆ†ç±»ID" ... />

ä¿®æ”¹å‰ (ç±»ä¼¼)ï¼š

ä»£ç æ®µ

<el-table-column label="åˆ†ç±»ID" align="center" prop="categoryId" />
ä¿®æ”¹åï¼š

ä»£ç æ®µ

<el-table-column label="åˆ†ç±»åç§°" align="center" prop="categoryName" />
2. ä¿®æ”¹è¯„è®ºåˆ—è¡¨ (æ˜¾ç¤ºæ–‡ç« æ ‡é¢˜)
æ–‡ä»¶ï¼š admin/RuoYi-Vue3/src/views/blog/comment/index.vue

æ“ä½œï¼š æ‰¾åˆ° <el-table-column label="æ–‡ç« ID" ... />

ä¿®æ”¹å‰ (ç±»ä¼¼)ï¼š

ä»£ç æ®µ

<el-table-column label="æ–‡ç« ID" align="center" prop="articleId" />
ä¿®æ”¹åï¼š

ä»£ç æ®µ

<el-table-column label="æ–‡ç« æ ‡é¢˜" align="center" prop="articleTitle" />
3. ä¿®æ”¹æ–‡ç« è¡¨å• (æ·»åŠ â€œåˆ†ç±»â€å’Œâ€œæ ‡ç­¾â€é€‰æ‹©)
æ–‡ä»¶ï¼š admin/RuoYi-Vue3/src/views/blog/article/index.vue

æ“ä½œï¼š

åœ¨ <script setup> ä¸­ï¼Œå¯¼å…¥ category å’Œ tag çš„ APIã€‚

åˆ›å»º categoryOptions å’Œ tagOptions ä¸¤ä¸ª refã€‚

åœ¨ handleAdd å’Œ handleUpdate (æ‰“å¼€å¼¹çª—) æ—¶ï¼ŒåŠ è½½è¿™ä¸¤ä¸ªåˆ—è¡¨çš„æ•°æ®ã€‚

åœ¨ <template> çš„å¼¹çª—è¡¨å•ä¸­ï¼Œä¿®æ”¹â€œåˆ†ç±»â€ç»„ä»¶ï¼Œå¹¶æ·»åŠ â€œæ ‡ç­¾â€ç»„ä»¶ã€‚

ä¿®æ”¹ <script setup>ï¼š

ä»£ç æ®µ

// ... (å·²æœ‰å¯¼å…¥) ...
// vvvvvv æ‰‹åŠ¨æ·»åŠ  vvvvvv
import { listCategory } from "@/api/blog/category";
import { listTag } from "@/api/blog/tag";
// ^^^^^^ æ‰‹åŠ¨æ·»åŠ  ^^^^^^

// ... (å·²æœ‰ const) ...
const { proxy } = getCurrentInstance();

// vvvvvv æ‰‹åŠ¨æ·»åŠ  vvvvvv
const categoryOptions = ref([]);
const tagOptions = ref([]);
// ^^^^^^ æ‰‹åŠ¨æ·»åŠ  ^^^^^^

// ... (å·²æœ‰ data) ...
const data = reactive({
  form: {},
  // ... (å·²æœ‰ rules) ...
});
const { form, rules } = toRefs(data);

// ... (å·²æœ‰ getList) ...

// vvvvvv æ‰‹åŠ¨æ·»åŠ  vvvvvv
/** æŸ¥è¯¢åˆ†ç±»åˆ—è¡¨ */
function getCategoryList() {
  listCategory(proxy.addDateRange(queryParams.value, dateRange.value)).then(response => {
    categoryOptions.value = response.rows;
  });
}
/** æŸ¥è¯¢æ ‡ç­¾åˆ—è¡¨ */
function getTagList() {
  listTag(proxy.addDateRange(queryParams.value, dateRange.value)).then(response => {
    tagOptions.value = response.rows;
  });
}
// ^^^^^^ æ‰‹åŠ¨æ·»åŠ  ^^^^^^

/** ä¿®æ”¹æŒ‰é’®æ“ä½œ */
function handleUpdate(row) {
  reset();
  const _articleId = row.articleId || ids.value[0];
  getArticle(_articleId).then(response => {
    form.value = response.data;
    
    // vvvvvv æ‰‹åŠ¨æ·»åŠ  vvvvvv
    // (ç¡®ä¿ response.data ä¸­åŒ…å«äº† tagIds æ•°ç»„, è¿™å¯èƒ½éœ€è¦æ‚¨ä¿®æ”¹ getArticle çš„åç«¯é€»è¾‘)
    // å¦‚æœ getArticle æ²¡æœ‰è¿”å› tagIds, æ‚¨éœ€è¦å¦ä¸€ä¸ªAPIå»è·å–
    // å‡è®¾ getArticle å·²è¿”å› tagIds:
    // form.value.tagIds = response.tagIds; 
    
    getCategoryList(); // åŠ è½½åˆ†ç±»
    getTagList(); // åŠ è½½æ ‡ç­¾
    // ^^^^^^ æ‰‹åŠ¨æ·»åŠ  ^^^^^^
    
    open.value = true;
    title.value = "ä¿®æ”¹åšå®¢æ–‡ç« ";
  });
}

/** æ–°å¢æŒ‰é’®æ“ä½œ */
function handleAdd() {
  reset();
  // vvvvvv æ‰‹åŠ¨æ·»åŠ  vvvvvv
  getCategoryList(); // åŠ è½½åˆ†ç±»
  getTagList(); // åŠ è½½æ ‡ç­¾
  // ^^^^^^ æ‰‹åŠ¨æ·»åŠ  ^^^^^^
  open.value = true;
  title.value = "æ·»åŠ åšå®¢æ–‡ç« ";
}

// ... (å…¶ä»–æ–¹æ³•) ...
ä¿®æ”¹ <template> (å¼¹çª—è¡¨å•éƒ¨åˆ†)ï¼š

ä»£ç æ®µ

<el-form-item label="åˆ†ç±»ID" prop="categoryId">
  <el-input v-model="form.categoryId" placeholder="è¯·è¾“å…¥åˆ†ç±»ID" />
</el-form-item>

<el-form-item label="æ–‡ç« åˆ†ç±»" prop="categoryId">
  <el-select v-model="form.categoryId" placeholder="è¯·é€‰æ‹©åˆ†ç±»" style="width:100%">
    <el-option
      v-for="item in categoryOptions"
      :key="item.categoryId"
      :label="item.name"
      :value="item.categoryId"
    ></el-option>
  </el-select>
</el-form-item>

<el-form-item label="æ–‡ç« æ ‡ç­¾" prop="tagIds">
  <el-select v-model="form.tagIds" multiple placeholder="è¯·é€‰æ‹©æ ‡ç­¾" style="width:100%">
    <el-option
      v-for="item in tagOptions"
      :key="item.tagId"
      :label="item.name"
      :value="item.tagId"
    ></el-option>
  </el-select>
</el-form-item>

<el-form-item label="æ–‡ç« å†…å®¹">
  <el-input v-model="form.content" type="textarea" placeholder="è¯·è¾“å…¥å†…å®¹" />
</el-form-item>

<el-form-item label="æ–‡ç« å†…å®¹" prop="content">
  <editor v-model="form.content" :min-height="192"/>
</el-form-item>
å®Œæˆä»¥ä¸Šæ‰€æœ‰ä¿®æ”¹åï¼Œé‡æ–°å¯åŠ¨æ‚¨çš„åç«¯æœåŠ¡ï¼Œå¹¶è¿è¡Œå‰ç«¯é¡¹ç›®ã€‚æ‚¨çš„åšå®¢æ¨¡å—ç°åœ¨å°±æ‹¥æœ‰äº†â€œå¤šå¯¹å¤šæ ‡ç­¾â€çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œå¹¶ä¸”åˆ—è¡¨é¡µä¹Ÿæ›´åŠ å‹å¥½äº†ã€‚